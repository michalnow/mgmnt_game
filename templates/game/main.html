{% extends 'base.html' %}

{% block title %}Game{% endblock %}

{% block content %}
    <div id="game-main" class="app">
        <form id="form_game" class="form-horizontal" method="post" onsubmit="send_request(event, 'form_game')">
            {% csrf_token %}
            <p>
                <label for="id_test1">Test field 1:</label>
                <input type="text" name="test1" id="id_test1">
            </p>
            <p>
                <label for="id_test2">Test field 2:</label>
                <input type="text" name="test2" id="id_test2">
            </p>
            <button type="submit" class="btn btn-success">Send</button>
        </form>
    </div>
{% endblock %}
{% block script %}
    <script type="text/javascript">
        function send_request(event, form) {
            let request;

            event.preventDefault();

            // Abort any pending request
            if (request) {
                request.abort();
            }

            // Let's select and cache all the fields
            let form_element = $("#" + form);
            let test1_field = $("#id_test1").val();
            let test2_field = $("#id_test2").val();

            let inputs = form_element.find("input, button");


            //Define Data to be sent
            let formData = {
                'test1': test1_field,
                'test2': test2_field,
            };

            // Let's disable the inputs for the duration of the Ajax request.
            inputs.prop("disabled", true);

            // Fire off the request to backend
            request = $.ajax({
                headers: {'X-CSRFToken': $("[name=csrfmiddlewaretoken]").val()},
                url: "{% url 'game-main' %}",
                type: "post",
                data: formData,
                dataType: 'json',
                encode: true
            });

            // Callback handler that will be called on success
            request.done(function (response, textStatus, jqXHR) {
                console.log(response);
            });

            // Callback handler that will be called on failure
            request.fail(function (jqXHR, textStatus, errorThrown) {
                console.log(textStatus, errorThrown);
            });

            // Callback handler that will be called regardless
            // if the request failed or succeeded
            request.always(function () {
                // Reenable the inputs
                inputs.prop("disabled", false);
            });


        }

    </script>
{% endblock %}